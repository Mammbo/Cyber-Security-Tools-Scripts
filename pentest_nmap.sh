#!/bin/bash

#this script was made for CCDC regionals 2024 and is supposed to scan your entire network for vulnerablities to then secure (Pentesting)
#Run this script in sudo
#variables basically
function reprompt_var {
	local reprompt_text="$1"
	local reprompt_new_val=''
	reprompt_value="${!2}"

	if [ $reprompt_value ]; then reprompt_text+=" [$reprompt_value]: "
	else reprompt_text+=': '; fi

	read -r -p "$reprompt_text" reprompt_new_val

	if [ "$reprompt_new_val" ]; then reprompt_value="$reprompt_new_val"; fi
}


function os_detection {
	# read the contents of the /etc/os-release file
	grep
	release_version=$(grep '^ID=' /etc/os-release)
	# Use conditional statements to detect the distribution
	if [[ "$release_version" -eq "ID=ubuntu" || "$release_version" -eq "ID=debian"  ]]; then
    	echo "This script is running a debian based system."
    	apt update -y
    	apt upgrade -y
    	apt install nano -y
    	apt install net-tools -y
    	apt install nmap -y
	#elif [[ grep "rhel" /etc/os-release || grep "centos" /etc/os-release || grep "fedora" /etc/os-release ]]; then
	#echo "This script is running on Red Hat, CentOS, or Fedora."
  	#  yum update
   	# yum upgrade
    	#yum install nano
    	#yum install net-tools
   	# yum install nmap -y
   	# dnf update
   	# dnf upgrade
   	# dnf install nano
   	# dnf install net-tools
   	# dnf -y install nmap
	else
    	echo "This script is running on an unsupported distribution."
    	echo "Make sure it is running an an appropiate OS."
    	exit
	fi
}

function nmap_scan {
	route
	reprompt_var 'route of network should be under destination' network
	network="$reprompt_value"

	ipaddr = $(ip a | grep inet)

	#stores all ips needed into a text file
	nmap -PR -sn "$network"/24 | awk '/Nmap scan/{gsub(/[()]/,"",$NF); print $NF > "nmap_scanned_ips.txt"}'

	#default nmap scans
	nmap -iL nmap_scanned_ips.txt >> nmap_scan_results.txt
	#port scan
	nmap -iL nmap_scanned_ips.txt -sS >> nmap_scan_ports.txt
	nmap -iL nmap_scanned_ips.txt -sT >> nmap_scan_ports.txt
	nmap -iL nmap_scanned_ips.txt -sU >> nmap_scan_ports.txt
	nmap -iL nmap_scanned_ips.txt -sY >> nmap_scan_ports.txt
	nmap -iL nmap_scanned_ips.txt -sN >> nmap_scan_ports.txt
	#OS scan
	nmap -iL nmap_scanned_ips.txt -O >> nmap_scan_results.txt
	#service and version scan
	nmap -iL nmap_scanned_ips.txt -sV >> nmap_scan_results.txt

	#vulnerability scans
	nmap -iL nmap_scanned_ips.txt --script smb-vuln-ms17-010.nse >> nmap_vuln_scans.txt
	nmap -iL nmap_scanned-ips.txt --script ftp-vsftpd-backdoor -p 21 >> nmap_vuln_scans.txt
	#all vuln scans
	nmap -iL nmap_scanned_ips.txt --script vuln >> nmap_vuln_scans.txt

	echo "Thank you for scanning have a good day!"

}

while true
do
   	 if (( $EUID != 0 )); then  
   		 echo " Please run as root"
   	 else
   		 echo "okay :)"
   		 os_detection
   		 nmap_scan
   		 exit   
   	 fi
done

